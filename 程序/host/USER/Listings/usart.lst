C51 COMPILER V9.56.0.0   USART                                                             02/24/2020 15:25:35 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE USART
OBJECT MODULE PLACED IN ..\OBJ\usart.obj
COMPILER INVOKED BY: D:\Program_File\Keil_v5\C51\BIN\C51.EXE ..\HARDWARE\USART\usart.c OPTIMIZE(8,SPEED) BROWSE INCDIR(.
                    -.\HARDWARE;..\SYSTEM;..\HARDWARE\DISPLAY;..\HARDWARE\USART;..\HARDWARE\TIM) DEBUG OBJECTEXTEND PRINT(.\Listings\usart.ls
                    -t) OBJECT(..\OBJ\usart.obj)

line level    source

   1          #include "usart.h"
   2          
   3          unsigned char R_X = 0; 
   4          unsigned char idata str[6] = {0x39,0x00,0x00,0x00,0x00,0x39};
   5          
   6          
   7          void UART_Init() //初始化uart
   8          {  
   9   1              TMOD|=0X20;  //定时器1定时器方式 工作模式2
  10   1              SCON=0X51; //选择工作模式1使能接收，允许发送，允许接收  
  11   1              EA=1; //开总中断        
  12   1              ES=1;  //开串口中断
  13   1              ET1=0;  //开定时器中断  
  14   1              PCON=0X80; //8位自动重载，波特率加倍    
  15   1              TH1=0XFA;  //用22.1184 mhz波特率
  16   1              TL1=0XFA; 
  17   1              TR1=1; //打开定时器1
  18   1      }
  19          
  20          
  21          
  22          void UART_Putch(uchar idata *dat)  //输出一个字节
  23          {
  24   1         uchar i;
  25   1         for(i=0 ;i<6;i++)    
  26   1         {
  27   2                              SBUF=dat[i]; //把数据送到sbuf缓冲器中                                     
  28   2                              while(TI!=1);   //发送标志位T1如果发送了为1，没发送为0，没发送等待，到了退出循环
  29   2                              TI=0;  //到了T1清零
  30   2              }
  31   1      }
  32          
  33          
  34          void UART_IRQHandler() interrupt 4  //uart中断 ,4为串口中断
  35          {
  36   1       
  37   1                if(RI==1)  //收到数据
  38   1                {
  39   2                              R_X=SBUF;
  40   2                              if(R_X==0x23)
  41   2                              {  
  42   3                                      UART_Putch(str);
  43   3                                      RI=0;
  44   3                              }
  45   2                              else
  46   2                              {
  47   3                                      RI=0;
  48   3                              }
  49   2                }
  50   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
C51 COMPILER V9.56.0.0   USART                                                             02/24/2020 15:25:35 PAGE 2   

   CODE SIZE        =     88    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1    ----
   IDATA SIZE       =      6    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
